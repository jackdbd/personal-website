# personal-website

<!-- Do NOT edit this file manually. Instead, re-run `npm run readme`. -->

{{badges}}

My personal website and blog, built with [11ty](https://www.11ty.dev/) and [Workbox](https://github.com/googlechrome/workbox). Hosted on [Cloudflare Pages](https://pages.cloudflare.com/).

<!-- toc -->

## Features

<!-- {{features}} -->

- PWA with [web application manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest)
- RSS feed with [@11ty/eleventy-plugin-rss](https://www.11ty.dev/docs/plugins/rss/)
- [webmentions](https://indieweb.org/Webmention) sent to [Webmention.io](https://webmention.io/) and collected by [Bridgy](https://brid.gy)
- [WebC](https://www.11ty.dev/docs/languages/webc/) component to send webmentions using a Progressive Enhancement friendly HTML form
- `sitemap.xml` and `robots.txt` for SEO
- `security.txt` in `.well-known` directory
- just-in-time preloading with [instant.page](https://instant.page/)
- Service worker generated with [workbox-core](https://developer.chrome.com/docs/workbox/modules/workbox-core/) and [esbuild](https://github.com/evanw/esbuild)
- Modular type scale and fluid space system thanks to [Utopia](https://utopia.fyi/)
- Performance reports with multiple [performance budgets](https://www.afasterweb.com/2020/01/28/performance-budgets-with-lighthouse/) using the [Lighthouse CLI](https://github.com/GoogleChrome/lighthouse#using-the-node-cli) and [webhint](https://github.com/webhintio/hint)
- HTML minified using [html-minifier-terser](https://github.com/terser/html-minifier-terser) (only when building for production)
- CSS on the critical path minified with [clean-css](https://www.11ty.dev/docs/quicktips/inline-css/) and inlined in the `<head>`. All other CSS is managed by [PostCSS](https://github.com/postcss/postcss).
- Embeds for YouTube and Video thanks to [eleventy-plugin-youtube-embed](https://github.com/gfscott/eleventy-plugin-embed-everything/tree/main/packages/youtube) and [eleventy-plugin-vimeo-embed](https://github.com/gfscott/eleventy-plugin-embed-everything/tree/main/packages/vimeo)
- Framework agnostic partial hydration with [@11ty/is-land](https://github.com/11ty/is-land)
- [Custom HTTP headers](https://developers.cloudflare.com/pages/how-to/add-custom-http-headers/) for the [Reporting API](https://developer.mozilla.org/en-US/docs/Web/API/Reporting_API):
  - [Report-To](https://developers.google.com/web/updates/2018/09/reportingapi#header) and [Reporting-Endpoints](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Reporting-Endpoints)
  - [Content-Security-Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
  - [Network Error Logging](https://developer.cdn.mozilla.net/en-US/docs/Web/HTTP/Headers/NEL)
  - [Permissions-Policy](https://scotthelme.co.uk/goodbye-feature-policy-and-hello-permissions-policy/)
- Configurable text to speech synthesis, thanks to [@jackdbd/eleventy-plugin-text-to-speech](https://github.com/jackdbd/undici/tree/main/packages/eleventy-plugin-text-to-speech)
- [Scripts](./scripts/README.md) I use for various administrative tasks

## Installation

Clone the repo:

```shell
git clone git@github.com:jackdbd/personal-website.git
```

{{engines.node}}

{{flake.nix}}

If you want to run scrips/tests that rely on [Playwright](https://playwright.dev/), you will also need to install/update the browsers it uses:

```sh
npx playwright install
```

## Development

Watch all templates, CSS, JS, and automatically refresh the browser:

```sh
npm run dev
```

Go to http://localhost:8080/ to visit the website.

In alternative, develop and preview the site with [wrangler](https://developers.cloudflare.com/pages/platform/functions/#develop-and-preview-locally) (this is useful when developing functions that will be deployed to [Cloudflare Pages Functions](https://developers.cloudflare.com/pages/platform/functions/)):

```sh
npm run wrangler
```

Go to http://localhost:8788/ to visit the website.

### Test the production build locally

Build all templates, CSS, JS, `_headers` file and the service worker:

```sh
npm run build
```

Serve the production build:

```sh
npm run site:serve
```

## Deploy

Just push to the remote repository. [This GitHub workflow](./.github/workflows/ci.yaml) will automatically deploy the website to Cloudflare Pages.

- Each push on the `main` branch will trigger a production deployment.
- Each push on any other branch will trigger a [preview deployment](https://developers.cloudflare.com/pages/platform/preview-deployments/).

{{cloudflarePages.callout}}

## Security

### Run a security audit on the HTTP headers

Generate the `_headers` file which will be used by Cloudflare Pages:

```sh
node scripts/headers.mjs
```

Check the `Content-Security-Policy` and the other security headers with these online tools:

- https://observatory.mozilla.org/
- https://securityheaders.com/
- https://csp-evaluator.withgoogle.com/

### Security policy

See [SECURITY.md](./SECURITY.md).

## Dependencies

### Production dependencies

{{pkg.dependencies}}

### Development dependencies

{{pkg.devDependencies}}

## Troubleshooting

### Troubleshooting the service worker

When developing, open Chrome DevTools, go to `Application > Service Workers` and check that:

- `Update on reload` is **enabled**. This ensures that the latest service worker will be **installed** and **activated** on the page.
- `Bypass for network` is **disabled**. This ensures that the route matchers, route handlers and runtime caches of the service worker will be used.

{{pkg.license}}
